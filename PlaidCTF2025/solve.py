# Solution script
from z3 import *

# Dùng optimize mode của Z3, đừng sử dụng solver

opt = Optimize()

# # Khai báo các biến biểu tượng 8-bit

names = ["s", "v5", "v6", "v7", "v8", "v9", "v10", "v11", "v12", "v13",
         "v14", "v15", "v16", "v17", "v18", "v19", "v20", "v21", "v22", "v23",
         "v24", "v25", "v26", "v27", "v28", "v29", "v30", "v31", "v32", "v33",
         "v34", "v35", "v36", "v37", "v38", "v39", "v40", "v41", "v42", "v43",
         "v44", "v45", "v46", "v47", "v48", "v49", "v50", "v51", "v52", "v53",
         "v54", "v55", "v56", "v57", "v58", "v59", "v60", "v61", "v62", "v63",
         "v64", "v65", "v66", "v67"]

vars = {name: BitVec(name, 8) for name in names}

# Đây là hàm thêm soft constraints một cách an toàn (mà không trùng lặp).
def add_soft(expr):
    opt.add_soft(expr)

# Chỉ thêm các constraints được xét là soft constaints
# VÍ DỤ:
add_soft(vars["v31"] == 50)
add_soft(vars["v35"] ^ vars["v28"] == 0xAA)
add_soft(vars["v35"] + vars["v50"] == 144)
add_soft(vars["v63"] + vars["v40"] == 129)
add_soft(vars["v17"] == 190)
add_soft(vars["v36"] == 100)
add_soft(vars["v30"] == 49)
add_soft(vars["v46"] == 57)
add_soft(vars["v49"] + vars["v67"] == 147)
add_soft(vars["v54"] == 49)
add_soft(vars["v5"] + vars["v19"] == 56)
add_soft(vars["v17"] ^ vars["v39"] == 0x8E)
add_soft(vars["v5"] ^ vars["v50"] == 0x71)
add_soft(vars["v46"] == 180)
add_soft(vars["v23"] == 54)
add_soft(vars["v32"] == vars["v52"])
add_soft(vars["v14"] ^ vars["v37"] == 3)
add_soft(vars["v34"] == 118)
add_soft(vars["v9"] == 50)
add_soft(vars["v5"] ^ vars["v52"] == 0x85)
add_soft(vars["v6"] == 84)
add_soft(vars["v27"] == 225)
add_soft(vars["v13"] ^ vars["v58"] == 0x81)
add_soft(vars["v57"] + vars["v30"] == 97)
add_soft(vars["v22"] ^ vars["v61"] == 7)
add_soft(vars["v22"] ^ vars["v9"] == 0x56)
add_soft(vars["v18"] + vars["v57"] == 102)
add_soft(vars["v52"] ^ vars["v60"] == 0x54)
add_soft(vars["v56"] == 229)
add_soft(vars["v40"] == 111)
add_soft(vars["v41"] + vars["v34"] == 102)
add_soft(vars["v54"] == 49)
add_soft(vars["v27"] == 56)
add_soft(vars["v43"] == 52)
add_soft(vars["v60"] + vars["v23"] == 151)
add_soft(vars["v23"] ^ vars["v54"] == 0x2D)
add_soft(vars["v38"] + vars["v5"] == 164)
add_soft(vars["v51"] + vars["v42"] == 244)
add_soft(vars["v31"] + vars["v51"] == 151)
add_soft(vars["v51"] + vars["v14"] == 150)
add_soft(vars["v6"] == 114)
add_soft(vars["v63"] == 54)
add_soft(vars["v32"] == 177)
add_soft(vars["v12"] ^ vars["v62"] == 8)
add_soft(vars["v6"] ^ vars["v50"] == 0x3A)
add_soft(vars["v63"] == 68)
add_soft(vars["v61"] == 18)
add_soft(vars["v21"] ^ vars["v44"] == 0x5B)
add_soft(vars["v45"] == 42)
add_soft(vars["v45"] == 51)
add_soft(vars["v30"] + vars["v42"] == 63)
add_soft(vars["v65"] ^ vars["s"] == 0x60)
add_soft(vars["v25"] == 36)
add_soft(vars["v9"] + vars["v47"] == 45)
add_soft(vars["v61"] == 99)
add_soft(vars["v59"] ^ vars["v56"] == 5)
add_soft(vars["v8"] == 123)
add_soft(vars["v20"] + vars["v13"] == 173)
add_soft(vars["v26"] + vars["v49"] == 152)
add_soft(vars["v28"] == 50)
add_soft(vars["v52"] == 53)
add_soft(vars["v58"] ^ vars["v23"] == 0x5B)
add_soft(vars["v58"] + vars["v18"] == 153)
add_soft(vars["v57"] == 210)
add_soft(vars["s"] ^ vars["v52"] == 0x65)
add_soft(vars["v46"] + vars["v53"] == 154)
add_soft(vars["v24"] + vars["v33"] == 150)
add_soft(vars["v44"] ^ vars["v54"] == 0xDA)
add_soft(vars["v64"] + vars["v36"] == 150)
add_soft(vars["v43"] + vars["v11"] == 152)
add_soft(vars["v54"] == vars["v14"])
add_soft(vars["v61"] ^ vars["v14"] == 0x52)
add_soft(vars["v60"] == 97)
add_soft(vars["v24"] == 97)
add_soft(vars["v66"] ^ vars["v12"] == 1)
add_soft(vars["v48"] ^ vars["v38"] == 0x30)
add_soft(vars["v37"] == 50)
add_soft(vars["v51"] ^ vars["v53"] == 4)
add_soft(vars["v31"] ^ vars["v26"] == 0x53)
add_soft(vars["s"] + vars["v45"] == 131)
add_soft(vars["v22"] == 241)
add_soft(vars["v32"] == 53)
add_soft(vars["v20"] == 211)
add_soft(vars["v10"] + vars["v51"] == 153)
add_soft(vars["v32"] + vars["v29"] == 175)
add_soft(vars["v67"] + vars["v23"] == 179)
add_soft(vars["v33"] == 53)
add_soft(vars["v65"] == 48)
add_soft(vars["v19"] + vars["v29"] == 133)
add_soft(vars["v24"] ^ vars["v65"] == 0x4F)
add_soft(vars["v31"] ^ vars["v54"] == 3)
add_soft(vars["v66"] + vars["v55"] == 98)
add_soft(vars["v24"] + vars["v48"] == 197)
add_soft(vars["v47"] + vars["v22"] == 201)
add_soft(vars["v13"] + vars["v40"] == 104)
add_soft(vars["v13"] == vars["v23"])
add_soft(vars["v23"] ^ vars["v37"] == 4)
add_soft(vars["v59"] + vars["s"] == 133)
add_soft(vars["v26"] == 97)
add_soft(vars["v21"] == 57)
add_soft(vars["v14"] == 49)
add_soft(vars["v57"] == 48)
add_soft(vars["v53"] + vars["v65"] == 233)
add_soft(vars["v54"] == 49)
add_soft(vars["v59"] + vars["v7"] == 191)
add_soft(vars["v49"] + vars["v29"] == 153)
add_soft(vars["v50"] == 50)
add_soft(vars["v28"] + vars["v47"] == 151)
add_soft(vars["v30"] == 49)
add_soft(vars["v18"] == 54)
add_soft(vars["v7"] + vars["v66"] == 118)
add_soft(vars["v31"] == 50)
add_soft(vars["v67"] ^ vars["v49"] == 0x4A)
add_soft(vars["v48"] + vars["v18"] == 240)
add_soft(vars["v13"] == 216)
add_soft(vars["v62"] + vars["v66"] == 98)
add_soft(vars["v65"] + vars["v26"] == 147)
add_soft(vars["v55"] ^ vars["v57"] == 2)
add_soft(vars["v31"] == 50)
add_soft(vars["v54"] ^ vars["v63"] == 7)
add_soft(vars["v56"] == 48)
add_soft(vars["v37"] == 121)
add_soft(vars["v65"] == 51)
add_soft(vars["v25"] + vars["v53"] == 197)
add_soft(vars["v40"] == 83)
add_soft(vars["v19"] == 9)
add_soft(vars["s"] + vars["v36"] == 180)
add_soft(vars["v18"] + vars["v55"] == 104)
add_soft(vars["v47"] ^ vars["v18"] == 0xFB)
add_soft(vars["v62"] == 79)
add_soft(vars["v14"] == 62)
add_soft(vars["v51"] == 236)
add_soft(vars["v49"] == 55)
add_soft(vars["v26"] + vars["v63"] == 255)
add_soft(vars["v28"] ^ vars["v6"] == 0x28)
add_soft(vars["v52"] == 209)
add_soft(vars["v59"] ^ vars["v11"] == 0xE8)
add_soft(vars["v51"] == 101)
add_soft(vars["v9"] + vars["v61"] == 252)
add_soft(vars["v28"] + vars["v9"] == 100)
add_soft(vars["v38"] ^ vars["v58"] == 2)
add_soft(vars["v13"] == 54)
add_soft(vars["v9"] == 50)
add_soft(vars["v30"] == 49)
add_soft(vars["v64"] == 50)
add_soft(vars["v8"] + vars["v11"] == 223)
add_soft(vars["v35"] == 52)
add_soft(vars["v54"] ^ vars["v56"] == 0x59)
add_soft(vars["v62"] == 57)
add_soft(vars["v16"] ^ vars["v47"] == 0x53)
add_soft(vars["v11"] == 97)
add_soft(vars["v57"] ^ vars["v11"] == 0x54)
add_soft(vars["v63"] + vars["v10"] == 106)
add_soft(vars["v21"] + vars["v32"] == 110)
add_soft(vars["v8"] == 123)
add_soft(vars["v39"] == 101)
add_soft(vars["v40"] + vars["v48"] == 150)
add_soft(vars["v67"] == 125)
add_soft(vars["v31"] ^ vars["v45"] == 0x5D)
add_soft(vars["v44"] == 98)
add_soft(vars["v28"] ^ vars["v25"] == 0x63)
add_soft(vars["v25"] ^ vars["v23"] == 0x52)
add_soft(vars["v14"] == 49)
add_soft(vars["v41"] + vars["v10"] == 103)
add_soft(vars["v10"] == 123)
add_soft(vars["v60"] == 147)
add_soft(vars["v13"] ^ vars["v33"] == 3)
add_soft(vars["v51"] == 199)
add_soft(vars["v33"] == 53)
add_soft(vars["v67"] == 125)
add_soft(vars["v55"] + vars["v42"] == 71)
add_soft(vars["v64"] + vars["v24"] == 147)
add_soft(vars["v5"] ^ vars["v19"] == 0x74)
add_soft(vars["v15"] ^ vars["v62"] == 0x16)
add_soft(vars["v54"] == 49)
add_soft(vars["s"] + vars["v67"] == 205)
add_soft(vars["v64"] == 50)
add_soft(vars["v58"] == 99)
add_soft(vars["v11"] == 75)
add_soft(vars["v33"] ^ vars["v44"] == 0x57)
add_soft(vars["v62"] == 57)
add_soft(vars["v37"] ^ vars["v48"] == 0x56)
add_soft(vars["v21"] == 150)
add_soft(vars["v23"] == 171)
add_soft(vars["v63"] + vars["v55"] == 175)
add_soft(vars["v25"] == 127)
add_soft(vars["v39"] ^ vars["v15"] == 0xD1)
add_soft(vars["v44"] == 98)
add_soft(vars["v22"] ^ vars["v17"] == 0x5E)
add_soft(vars["v11"] == 22)
add_soft(vars["v58"] + vars["v10"] == 151)
add_soft(vars["v54"] == 49)
add_soft(vars["v49"] == 55)
add_soft(vars["v23"] + vars["v9"] == 104)
add_soft(vars["v8"] == 26)
add_soft(vars["v66"] == 48)
add_soft(vars["v16"] ^ vars["v28"] == 4)
add_soft(vars["v50"] + vars["v36"] == 150)
add_soft(vars["v38"] == 97)
add_soft(vars["v7"] == 70)
add_soft(vars["v15"] + vars["v51"] == 151)
add_soft(vars["v50"] == 50)
add_soft(vars["v29"] == 96)
add_soft(vars["v13"] == 54)
add_soft(vars["v30"] == 58)
add_soft(vars["v59"] ^ vars["v46"] == 0xC)
add_soft(vars["v38"] ^ vars["v23"] == 0x57)
add_soft(vars["v60"] == 97)
add_soft(vars["v47"] ^ vars["v35"] == 0x51)
add_soft(vars["v59"] == 53)
add_soft(vars["v13"] == 169)
add_soft(vars["v50"] + vars["v7"] == 120)
add_soft(vars["v52"] == 31)
add_soft(vars["v39"] + vars["v27"] == 157)
add_soft(vars["v40"] == 109)
add_soft(vars["v34"] ^ vars["v32"] == 6)
add_soft(vars["v57"] == 48)
add_soft(vars["v24"] == 247)
add_soft(vars["v54"] == 49)
add_soft(vars["v64"] + vars["v49"] == 105)
add_soft(vars["v45"] ^ vars["v16"] == 5)
add_soft(vars["v13"] ^ vars["v46"] == 0x85)
add_soft(vars["v36"] == 100)
add_soft(vars["v57"] == 48)
add_soft(vars["v42"] + vars["v59"] == 103)
add_soft(vars["v36"] == vars["v17"])
add_soft(vars["v40"] == 50)
add_soft(vars["v27"] == 155)
add_soft(vars["v17"] == 100)
add_soft(vars["v12"] == 49)
add_soft(vars["v40"] == 50)
add_soft(vars["v18"] == 195)
add_soft(vars["v45"] + vars["v25"] == 151)
add_soft(vars["v49"] + vars["v41"] == 106)
add_soft(vars["v36"] == 50)
add_soft(vars["v48"] == 100)
add_soft(vars["v6"] == 84)
add_soft(vars["v39"] ^ vars["v54"] == 0x54)
add_soft(vars["v55"] == 50)
add_soft(vars["v52"] == 53)
add_soft(vars["v45"] == 51)
add_soft(vars["v31"] == 50)
add_soft(vars["v53"] + vars["v63"] == 151)
add_soft(vars["v40"] == 50)
add_soft(vars["v26"] == 97)
add_soft(vars["v59"] + vars["v8"] == 18)
add_soft(vars["v50"] == 158)
add_soft(vars["v26"] ^ vars["v35"] == 0x55)
add_soft(vars["v54"] == 67)
add_soft(vars["v27"] == 56)
add_soft(vars["v56"] == 12)
add_soft(vars["v56"] == 48)
add_soft(vars["v26"] == 97)
add_soft(vars["v18"] == 54)
add_soft(vars["v6"] == 84)
add_soft(vars["v12"] ^ vars["v26"] == 0x50)
add_soft(vars["v39"] + vars["s"] == 167)
add_soft(vars["v43"] + vars["v6"] == 199)
add_soft(vars["v45"] ^ vars["v10"] == 7)
add_soft(vars["v37"] + vars["v15"] == 165)
add_soft(vars["v29"] == 98)
add_soft(vars["v30"] == 49)
add_soft(vars["v24"] + vars["v31"] == 35)
add_soft(vars["v10"] ^ vars["v39"] == 0x9C)
add_soft(vars["v18"] ^ vars["v15"] == 4)
add_soft(vars["v43"] == 52)
add_soft(vars["v44"] + vars["v35"] == 150)
add_soft(vars["v61"] == 99)
add_soft(vars["v11"] == 100)
add_soft(vars["v18"] == 54)
add_soft(vars["v9"] == 67)
add_soft(vars["v27"] ^ vars["v26"] == 0x59)
add_soft(vars["v25"] == 100)
add_soft(vars["v26"] ^ vars["v48"] == 5)
add_soft(vars["v57"] == 48)
add_soft(vars["v35"] == 52)
add_soft(vars["v26"] == 97)
add_soft(vars["v50"] + vars["v12"] == 122)
add_soft(vars["v29"] ^ vars["v7"] == 0x24)
add_soft(vars["v47"] == 101)
add_soft(vars["v48"] == 15)
add_soft(vars["v20"] ^ vars["v25"] == 0x57)
add_soft(vars["v13"] ^ vars["v66"] == 6)
add_soft(vars["v31"] == 50)
add_soft(vars["v22"] + vars["v58"] == 209)
add_soft(vars["v36"] == 100)
add_soft(vars["v61"] + vars["v22"] == 199)
add_soft(vars["v47"] ^ vars["v36"] == 1)
add_soft(vars["v21"] == 164)
add_soft(vars["v12"] ^ vars["v13"] == 7)
add_soft(vars["v44"] == 98)
add_soft(vars["v60"] + vars["v8"] == 10)
add_soft(vars["v25"] + vars["v32"] == 153)
add_soft(vars["v16"] == 124)
add_soft(vars["v67"] + vars["v22"] == 225)
add_soft(vars["v31"] == 50)
add_soft(vars["v27"] == 56)
add_soft(vars["v48"] + vars["v22"] == 200)
add_soft(vars["v13"] + vars["v23"] == 108)
add_soft(vars["v65"] + vars["v15"] == 231)
add_soft(vars["v25"] == 100)
add_soft(vars["v61"] + vars["v35"] == 151)
add_soft(vars["v32"] ^ vars["v44"] == 0x57)
add_soft(vars["v49"] == 55)
add_soft(vars["v17"] + vars["v51"] == 201)
add_soft(vars["v22"] == 100)
add_soft(vars["v19"] == 55)
add_soft(vars["v62"] ^ vars["v20"] == 0xA)
add_soft(vars["s"] ^ vars["v25"] == 0x34)
add_soft(vars["v66"] + vars["v53"] == 145)
add_soft(vars["v50"] == 50)
add_soft(vars["v61"] + vars["s"] == 168)
add_soft(vars["v40"] == 50)
add_soft(vars["v54"] == 49)
add_soft(vars["v52"] == 53)
add_soft(vars["v46"] == 57)
add_soft(vars["v65"] + vars["v39"] == 149)
add_soft(vars["v31"] + vars["v5"] == 117)
add_soft(vars["v52"] == 53)
add_soft(vars["v39"] ^ vars["v37"] == 0x51)
add_soft(vars["v33"] ^ vars["v61"] == 0x56)
add_soft(vars["v27"] == 75)
add_soft(vars["v35"] + vars["v17"] == 172)
add_soft(vars["v43"] == 74)
add_soft(vars["v43"] == 52)
add_soft(vars["v37"] == 115)
add_soft(vars["v11"] == 100)
add_soft(vars["s"] == 80)
add_soft(vars["v26"] == 97)
add_soft(vars["v66"] + vars["v59"] == 101)
add_soft(vars["v56"] == 48)
add_soft(vars["v11"] + vars["v26"] == 204)
add_soft(vars["v30"] ^ vars["v18"] == 7)
add_soft(vars["v6"] == 84)
add_soft(vars["v50"] == 50)
add_soft(vars["v56"] == 48)
add_soft(vars["v58"] ^ vars["v39"] == 6)
add_soft(vars["v35"] ^ vars["v38"] == 0x55)
add_soft(vars["v37"] == 50)
add_soft(vars["v44"] + vars["v37"] == 148)
add_soft(vars["v11"] == 100)
add_soft(vars["v19"] == 55)
add_soft(vars["v14"] ^ vars["v47"] == 0x54)
add_soft(vars["v19"] == 55)
add_soft(vars["v33"] + vars["v34"] == 104)
add_soft(vars["v47"] ^ vars["v17"] == 1)
add_soft(vars["v62"] + vars["v28"] == 217)
add_soft(vars["v21"] + vars["v65"] == 105)
add_soft(vars["v45"] == 166)
add_soft(vars["v58"] ^ vars["v28"] == 0x51)
add_soft(vars["v66"] == 48)
add_soft(vars["v61"] + vars["v41"] == 150)
add_soft(vars["v65"] ^ vars["v8"] == 0x4B)
add_soft(vars["v41"] + vars["v56"] == 99)
add_soft(vars["v25"] ^ vars["v30"] == 0x3D)
add_soft(vars["v54"] == 233)
add_soft(vars["v9"] ^ vars["v33"] == 7)
add_soft(vars["v35"] == 52)
add_soft(vars["v57"] == 1)
add_soft(vars["v19"] + vars["v11"] == 155)
add_soft(vars["v45"] == 51)
add_soft(vars["v39"] + vars["v31"] == 151)
add_soft(vars["v46"] == 57)
add_soft(vars["v31"] == 50)
add_soft(vars["v51"] == 101)
add_soft(vars["v49"] ^ vars["v34"] == 4)
add_soft(vars["v34"] == 51)
add_soft(vars["v26"] == 97)
add_soft(vars["v53"] == 97)
add_soft(vars["v35"] + vars["v25"] == 152)
add_soft(vars["v28"] == 50)
add_soft(vars["v19"] == 55)
add_soft(vars["v39"] == 203)
add_soft(vars["v8"] + vars["v41"] == 174)
add_soft(vars["v53"] == 97)
add_soft(vars["v11"] ^ vars["v35"] == 0x50)
add_soft(vars["v19"] + vars["v23"] == 109)
add_soft(vars["v34"] ^ vars["v26"] == 0xC7)
add_soft(vars["v20"] ^ vars["v64"] == 1)
add_soft(vars["v16"] == 54)
add_soft(vars["v32"] == 1)
add_soft(vars["v48"] + vars["v62"] == 157)
add_soft(vars["v53"] ^ vars["v41"] == 0x52)
add_soft(vars["v10"] == 52)
add_soft(vars["v42"] == 50)
add_soft(vars["v66"] == 48)
add_soft(vars["v41"] ^ vars["v25"] == 0x57)
add_soft(vars["v44"] + vars["v9"] == 148)
add_soft(vars["v15"] + vars["v38"] == 147)
add_soft(vars["v47"] == 153)
add_soft(vars["v26"] + vars["v31"] == 136)
add_soft(vars["v50"] == vars["v42"])
add_soft(vars["v52"] ^ vars["v65"] == 5)
add_soft(vars["v16"] == 86)
add_soft(vars["v48"] ^ vars["v32"] == 0x51)
add_soft(vars["v49"] == 55)
add_soft(vars["v41"] ^ vars["v6"] == 0x67)
# Tiếp tục lặp lại cho tới khi hết constaints

# ================================
# Sử dụng cùng một logic để thêm tất cả chúng dưới dạng soft constraints
# ================================

# Giải quyết để có được nhiều constraints thỏa mãn nhất có thể
if opt.check() == sat:
    model = opt.model()
    print("Da tim ra dap an thoa man:")
    for name in names:
        print(f"{name} = {model[vars[name]]}")
else:
    print("Khong tim ra cau tra loi")
